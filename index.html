<script>
document.addEventListener("DOMContentLoaded", () => {
  
  const s3Url = "https://solar-smash-webgl.s3.us-east-2.amazonaws.com"; // S3 for data/wasm/assets
  const cdnUrl = "https://cdn.jsdelivr.net/gh/dartsc/Solar-Smash-WEBFIX@latest/Build"; // jsDelivr for loader/framework
  const loaderUrl = cdnUrl + "/Build.loader.js";
  const ytApiUrl = "https://www.youtube.com/game_api/v1"; // YT Game API

  const container = document.createElement("div");
  container.id = "unity-container";
  container.style.position = "fixed";
  container.style.top = "0";
  container.style.left = "0";
  container.style.width = "100%";
  container.style.height = "100%";
  container.style.background = "#000";
  document.body.appendChild(container);

  const canvas = document.createElement("canvas");
  canvas.id = "unity-canvas";
  canvas.tabIndex = -1;
  canvas.style.width = "100%";
  canvas.style.height = "100%";
  container.appendChild(canvas);

  const loadingBar = document.createElement("div");
  loadingBar.id = "unity-loading-bar";
  loadingBar.style.position = "absolute";
  loadingBar.style.top = "50%";
  loadingBar.style.left = "50%";
  loadingBar.style.transform = "translate(-50%, -50%)";
  loadingBar.style.width = "50%";
  loadingBar.style.maxWidth = "600px";
  container.appendChild(loadingBar);

  const progressBarEmpty = document.createElement("div");
  progressBarEmpty.id = "unity-progress-bar-empty";
  progressBarEmpty.style.width = "100%";
  progressBarEmpty.style.background = "#ccc";
  loadingBar.appendChild(progressBarEmpty);

  const progressBarFull = document.createElement("div");
  progressBarFull.id = "unity-progress-bar-full";
  progressBarFull.style.width = "0%";
  progressBarFull.style.height = "20px";
  progressBarFull.style.background = "#4caf50";
  progressBarEmpty.appendChild(progressBarFull);

  const warningBanner = document.createElement("div");
  warningBanner.id = "unity-warning";
  warningBanner.style.position = "absolute";
  warningBanner.style.top = "0";
  warningBanner.style.width = "100%";
  warningBanner.style.textAlign = "center";
  warningBanner.style.color = "white";
  warningBanner.style.background = "red";
  warningBanner.style.display = "none";
  container.appendChild(warningBanner);

  function unityShowBanner(msg, type) {
    warningBanner.style.display = "block";
    warningBanner.textContent = msg;
    if (type === "error") warningBanner.style.background = "red";
    if (type === "warning") {
      warningBanner.style.background = "yellow";
      warningBanner.style.color = "black";
    }
  }

  const config = {
    dataUrl: s3Url + "/Build/Build.data",
    frameworkUrl: cdnUrl + "/Build.framework.js",
    codeUrl: s3Url + "/Build/Build.wasm",
    DynamicUI: s3Url + "/StreamingAssets/AssetBundles/WebGL/dynamic_ui",
    UI: s3Url + "/StreamingAssets/AssetBundles/WebGL/ui",
    Localisation: s3Url + "/StreamingAssets/AssetBundles/WebGL/localisation",
    audio_ui: s3Url + "/StreamingAssets/AssetBundles/WebGL/audio_ui",
    music: s3Url + "/StreamingAssets/AssetBundles/WebGL/music",
    fonts: s3Url + "/StreamingAssets/AssetBundles/WebGL/fonts",
    audio_weapons: s3Url + "/StreamingAssets/AssetBundles/WebGL/audio_weapons",
    planets: s3Url + "/StreamingAssets/AssetBundles/WebGL/planets",
    weapons: s3Url + "/StreamingAssets/AssetBundles/WebGL/weapons",
    companyName: "Paradyme Games",
    productName: "Solar Smash FIX",
    productVersion: "0.1.0",
    showBanner: unityShowBanner,
    autoSyncPersistentDataPath: true
  };

  if (/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)) {
    const meta = document.createElement('meta');
    meta.name = 'viewport';
    meta.content = 'width=device-width, height=device-height, initial-scale=1.0, user-scalable=no, shrink-to-fit=yes';
    document.head.appendChild(meta);
    container.className = "unity-mobile";
    canvas.className = "unity-mobile";
  } else {
    canvas.style.width = "100%";
    canvas.style.height = "100%";
  }

  loadingBar.style.display = "block";

  function loadYTGameAPI(callback) {
    const ytScript = document.createElement("script");
    ytScript.src = ytApiUrl;
    ytScript.onload = callback;
    document.body.appendChild(ytScript);
  }

  function InitUnitySection() {
    const script = document.createElement("script");
    script.src = loaderUrl;
    script.onload = () => {
      createUnityInstance(canvas, config, (progress) => {
        progressBarFull.style.width = (progress * 100) + "%";
      }).then(instance => {
        window.unityGameInstance = instance;
        loadingBar.style.display = "none";
      }).catch(console.error);
    };
    document.body.appendChild(script);
  }

  loadYTGameAPI(InitUnitySection);
});
</script>
